<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Make Payment - Koshya Voucher System</title>
    <link rel="stylesheet" href="{% load static %}{% static 'css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Alert Container -->
    <div id="alertContainer" class="container" style="position: fixed; top: 20px; right: 20px; z-index: 1001;"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
                <a href="/" class="logo">🎫 <span style="color: var(--primary-color);">Koshya</span> <span style="color: var(--text-secondary);">Voucher System</span></a>
            <nav class="nav">
                <a href="/admin/" class="nav-link">Admin</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container" style="max-width: 600px; margin: 50px auto;">
        <div class="card">
            <div class="card-header text-center">
                <h1 class="card-title">💳 Make Payment</h1>
                <p class="text-secondary">Use your voucher to make a payment</p>
            </div>
            <div class="card-body">
                <form id="paymentForm">
                    <div class="form-group">
                        <label class="form-label" for="voucher_code">Voucher Code</label>
                        <input type="text" id="voucher_code" name="voucher_code" class="form-input" 
                               required placeholder="Enter your voucher code" 
                               style="text-transform: uppercase;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="amount">Payment Amount (Rs)</label>
                        <input type="number" id="amount" name="amount" class="form-input" 
                               min="0.01" step="0.01" required placeholder="Enter payment amount">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        💳 Process Payment
                    </button>
                </form>
            </div>
        </div>

        <!-- Payment Info -->
        <div class="card" style="margin-top: 2rem;">
            <div class="card-body">
                <h3 class="text-lg font-semibold mb-2">How to use vouchers:</h3>
                <ul class="text-secondary" style="padding-left: 1.5rem;">
                    <li>Enter your voucher code (8-character code)</li>
                    <li>Specify the payment amount</li>
                    <li>Click "Process Payment" to complete the transaction</li>
                    <li>Your voucher balance will be updated automatically</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Payment form handler
        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                voucher_code: formData.get('voucher_code').toUpperCase(),
                amount: parseFloat(formData.get('amount'))
            };

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<span class="loading"></span> Processing...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('/api/pay/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert(`✅ Payment successful! Remaining balance: Rs ${result.remaining_balance}`, 'success');
                    e.target.reset();
                } else {
                    showAlert(`❌ Payment failed: ${result.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showAlert(`❌ Payment failed: ${error.message}`, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Auto-uppercase voucher code
        document.getElementById('voucher_code').addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase();
        });

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>
